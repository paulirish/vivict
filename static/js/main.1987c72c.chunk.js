(this.webpackJsonpvivict=this.webpackJsonpvivict||[]).push([[0],{121:function(t,e,i){},123:function(t,e,i){},147:function(t,e){},149:function(t,e){},305:function(t,e,i){},306:function(t,e,i){},307:function(t,e,i){},308:function(t,e,i){},309:function(t,e,i){"use strict";i.r(e);var s=i(6),n=i(44),a=i.n(n),o=(i(121),i(122),i(123),i(106)),r=i(15),l=i.n(r),c=i(13),h=i(1);var d=t=>{let{onPlay:e,onStep:i,onFullscreen:s,playing:n,onSeek:a,position:o,duration:r}=t;return Object(h.jsxs)("div",{className:"controls",children:[Object(h.jsx)("button",{className:"btn btn-default",onClick:t=>{i(-1),t.stopPropagation()},children:Object(h.jsx)(c.g,{})}),Object(h.jsx)("button",{className:l()("btn","btn-default"),onClick:t=>{console.log("play/pause: "),e(),t.stopPropagation()},children:n?Object(h.jsx)(c.e,{}):Object(h.jsx)(c.f,{})}),Object(h.jsx)("button",{className:"btn btn-default",onClick:t=>{i(1),t.stopPropagation()},children:Object(h.jsx)(c.h,{})}),Object(h.jsx)("input",{type:"range",value:o,min:"0",max:r,step:"0.04",onInput:t=>{console.log("range value: ".concat(t.target.value));const e=parseFloat(t.target.value);a(e),t.stopPropagation()}}),Object(h.jsx)("button",{className:"btn btn-default glyphicon glyphicon-fullscreen",onClick:t=>{s(),t.stopPropagation()},children:Object(h.jsx)(c.d,{})})]})},u=i(109),p=i.n(u),m=i(110),g=i.n(m),f=i(116);function S(t){return!!t&&t.split("?")[0].endsWith(".m3u8")}function v(t,e){return 0===(i=e).indexOf("http://")||0===i.indexOf("https://")?e:t.replace(/\/[^/]*$/,"/"+e);var i}var b=i(115);function w(t){return!!t&&t.split("?")[0].endsWith(".mpd")}class E extends s.Component{constructor(t){super(t),this.state={zoom:1,panHorizontal:0,panVertical:0},this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onMetadataLoaded=this.onMetadataLoaded.bind(this),this.setVideoRef=t=>{this.videoElement=t}}onTimeUpdate(){this.props.onTimeUpdate&&this.props.onTimeUpdate(this.videoElement.currentTime)}onMetadataLoaded(){this.props.onDurationSet&&this.props.onDurationSet(this.videoElement.duration)}async play(){return this.videoElement.play()}pause(){this.videoElement.pause()}quickSeek(t){this.videoElement.currentTime=t}zoomIn(){this.zoom(1.1)}zoomOut(){this.zoom(.9090909090909091)}zoom(t){const e=(1-t)/2*document.documentElement.clientWidth+t*this.state.panHorizontal,i=(1-t)/2*document.documentElement.clientHeight+t*this.state.panVertical;this.setState({zoom:this.state.zoom*t,panHorizontal:e,panVertical:i})}pan(t,e){this.setState({panHorizontal:this.state.panHorizontal+t,panVertical:this.state.panVertical+e})}resetPanZoom(){const t=(document.documentElement.clientHeight-this.videoElement.offsetHeight/this.state.zoom)/2;this.setState({zoom:1,panHorizontal:0,panVertical:t})}async seek(t){return t>this.videoElement.duration?Promise.reject("Invalid seek position: ".concat(t,", media duration is ").concat(this.videoElement.duration)):new Promise(((e,i)=>{this.videoElement.addEventListener("seeked",(()=>{e()}),{once:!0}),this.videoElement.currentTime=t}))}async loadSource(t,e){return console.log("load source: ".concat(t," ").concat(e)),new Promise(((i,s)=>{this.videoElement.addEventListener("canplay",(()=>{i()}),{once:!0}),S(t)?this.loadHls(t,e):w(t)?this.loadDash(t,e):this.videoElement.src=t}))}setVariant(t){console.log("setVariant: ".concat(t)),this.state.dash?this.state.dash.setQualityFor("video",t):this.state.hls&&(this.state.hls.currentLevel=t)}loadDash(t,e){this.state.hls&&(this.state.hls.detachMedia(),this.setState({hls:null}));let i=this.state.dash;this.videoElement.addEventListener("canplay",(()=>{this.state.dash.setQualityFor("video",e)}),{once:!0}),i?i.attachSource(t):(i=g.a.MediaPlayer().create(),this.setState({dash:i}),i.updateSettings({streaming:{fastSwitchEnabled:!0,abr:{autoSwitchBitrate:{audio:!1,video:!1}}}}),i.initialize(this.videoElement,t,!1))}loadHls(t,e){this.setState({dash:null});let i=this.state.hls;i||(i=new p.a,this.setState({hls:i})),i.loadSource(t),i.attachMedia(this.videoElement),i.currentLevel=e}currentTime(){return this.videoElement.currentTime}componentDidMount(){this.videoElement.addEventListener("timeupdate",this.onTimeUpdate),this.videoElement.addEventListener("loadedmetadata",this.onMetadataLoaded)}componentWillUnmount(){this.videoElement.removeEventListener("timeupdate",this.onTimeUpdate),this.videoElement.removeEventListener("loadedmetadata",this.onMetadataLoaded)}render(){const t=parseInt(100*this.state.zoom)+"vw";return Object(h.jsx)("video",{muted:this.props.muted,ref:this.setVideoRef,tabIndex:"-1",style:{width:t,left:this.state.panHorizontal+"px",top:this.state.panVertical+"px"}})}}var O=E,y=(i(305),i(306),i(114)),V=i.n(y);async function j(t,e){const i=await fetch(t,{method:"GET",headers:{Range:"bytes=".concat(e.start,"-").concat(e.end)}});if(!i.ok)throw Error("Fetch failed with status: ".concat(i.status));return{data:await i.arrayBuffer(),contentLength:i.headers.get("Content-Length"),contentRange:i.headers.get("Content-Range")}}async function P(t){console.log("mp4Info: ".concat(t));let e=!1;const i=new V.a.createFile,s=new Promise(((s,n)=>{i.onError=t=>{e=!0,console.log(t),n(t)},i.onReady=t=>{e=!0,s(t)},async function(t,e,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10485760;if(t.startsWith("blob:")){const s=await fetch(t),n=await s.arrayBuffer();if(n.fileStart=0,e(n),!i())throw Error("Failed to parse mp4Info");return}let n=0,a=s;for(;!i();){const i=await j(t,{start:n,end:a}),o=i.data,r=parseInt(i.contentRange.split("/")[1]);if(o.fileStart=n,e(o),a===r)break;if(n=a,a=Math.min(r,n+s),o.length<s)break}}(t,(t=>{i.appendBuffer(t)}),(()=>e)).catch((t=>{n(t)}))}));return s}class R extends s.Component{constructor(t){super(t),this.stopPropagation=this.stopPropagation.bind(this),this.urlInputKeyDown=this.urlInputKeyDown.bind(this),this.state={source:this.props.defaultSource,metadata:null,showUrlInput:!1,visible:this.props.visible}}setInputRef(t){this.input=t}async loadHlsMetadata(t){const e=await async function(t){const e=await fetch(t),i=await e.text(),s=new f.a;s.push(i),s.end();const n=s.manifest.playlists.map((e=>({url:v(t,e.uri),bandwidth:e.attributes.BANDWIDTH,...e.attributes.RESOLUTION})));return{mainUrl:t,variants:n,selectedVariant:0}}(t);this.setState({metadata:e})}async loadDashMetadata(t){const e=await async function(t){const e=await fetch(t),i=await e.text();console.log("RAW DASH MANIFEST:"+i);const s=Object(b.a)(i);return console.log("DASH MANIFEST:\n"+JSON.stringify(s)),{mainUrl:t,variants:s.playlists.map(((t,e)=>({url:null,index:e,bandwidth:t.attributes.BANDWIDTH,...t.attributes.RESOLUTION}))),selectedVariant:0}}(t);this.setState({metadata:e})}async loadMp4Metadata(t){try{const e=(await P(t)).videoTracks[0],i={variants:[{bitrate:e.bitrate,width:e.video.width,height:e.video.height}]};this.setState({metadata:i})}catch(e){console.log("Failed to get mp4 info: ".concat(e));const t={variants:[{bitrate:0,width:0,height:0}]};this.setState({metadata:t})}}componentDidMount(){this.changeSource(this.state.source),console.log("Source selector add event listeners"),this.input.addEventListener("keydown",this.urlInputKeyDown),this.input.addEventListener("keypress",this.stopPropagation),this.input.addEventListener("keyup",this.stopPropagation)}componentWillUnmount(){this.input.removeEventListener("keydown",this.urlInputKeyDown),this.input.removeEventListener("keypress",this.stopPropagation),this.input.removeEventListener("keyup",this.stopPropagation)}stopPropagation(t){t.stopPropagation()}urlInputKeyDown(t){switch(t.stopPropagation(),t.keyCode){case 13:this.onUrlSelected(t.target.value);break;case 27:this.hideUrlInput()}}onBlur(){console.log("onBlur"),this.setState({showUrlInput:!1})}handleChange(t){t.target.files&&this.props.onChange(t.target.files[0])}showUrlInput(){this.setState({showUrlInput:!0})}hideUrlInput(){this.setState({showUrlInput:!1})}onUrlSelected(t){console.log("url: ".concat(t)),this.hideUrlInput();let e="url";S(t)?e="hls":w(t)&&(e="dash"),this.changeSource({type:e,name:t,url:t,variant:0})}onFileSelected(t){if(t.target.files&&t.target.files[0]){const e=t.target.files[0];this.changeSource({type:"file",name:e.name,url:window.URL.createObjectURL(e)})}}onVariantSelected(t){const e=parseInt(t.target.value);this.setVariant(e)}setVariant(t){const e=Object.assign({},this.state.source,{variant:t});this.setState({source:e}),this.props.onVariantChange&&this.props.onVariantChange(t)}async loadMetadata(t){"hls"===t.type?await this.loadHlsMetadata(t.url):"dash"===t.type?await this.loadDashMetadata(t.url):await this.loadMp4Metadata(t.url)}changeSource(t){const e=this.state.source;this.loadMetadata(t).then((()=>{this.setState({source:t}),this.props.onChange(Object.assign({},t)),"file"===e.type&&e.url&&window.URL.revokeObjectURL(e.url)}))}componentDidUpdate(t,e,i){this.state.showUrlInput&&this.input.focus()}currentUrl(){return"file"===this.state.source.type?"":this.state.source.url}formatMetadata(t,e,i){return"[".concat(Math.round(t/1e3),"kbit/s ").concat(e,"x").concat(i,"]")}renderSelectedSource(){if(this.state.showUrlInput)return null;const t=this.state.metadata;let e=null;if(t)if(t.variants.length>1){const i=t.variants.map(((t,e)=>Object(h.jsx)("option",{value:e,selected:e===this.state.source.variant,children:this.formatMetadata(t.bandwidth,t.width,t.height)},e)));e=Object(h.jsx)("select",{value:this.state.selectedVariant,onChange:t=>this.onVariantSelected(t),children:i})}else if(1===t.variants.length){const i=t.variants[0];e=Object(h.jsx)("span",{children:this.formatMetadata(i.bitrate,i.width,i.height)})}return Object(h.jsxs)("div",{className:"source-metadata",children:[Object(h.jsx)("div",{className:"source-name",title:this.state.source.name,children:this.state.source.name}),Object(h.jsx)("div",{children:e})]})}render(){return Object(h.jsxs)("div",{className:l()("source-selector",this.props.className,{hidden:!this.props.visible}),children:[Object(h.jsxs)("div",{className:"source-buttons",children:[Object(h.jsx)("div",{title:"open URL",className:"url-button",children:Object(h.jsx)(c.b,{style:{cursor:"pointer"},onClick:()=>this.showUrlInput()})}),Object(h.jsxs)("label",{title:"open local file",className:"source-file-input",onClick:t=>{this.hideUrlInput(),t.stopPropagation()},children:[Object(h.jsx)(c.a,{}),Object(h.jsx)("input",{type:"file",onChange:t=>this.onFileSelected(t)})]})]}),Object(h.jsx)("input",{className:l()("url-input",{hidden:!this.state.showUrlInput}),type:"text",ref:t=>this.setInputRef(t),onBlur:()=>this.onBlur(),defaultValue:this.currentUrl()}),this.renderSelectedSource()]})}}var C=R;i(307);class T extends s.Component{constructor(t){super(t),this.mouseMove=this.mouseMove.bind(this),this.mouseDown=this.mouseDown.bind(this),this.mouseUp=this.mouseUp.bind(this),console.log("Split view constructor"),this.state={splitPercent:0,dragStart:null,dragging:!1},this.setSplitViewContainerRef=t=>{this.splitViewContainer=t},this.setSplitViewClipperRef=t=>{this.splitViewClipper=t}}componentDidMount(){this.splitViewContainer.addEventListener("mousemove",this.mouseMove,{passive:!0}),this.splitViewContainer.addEventListener("mousedown",this.mouseDown),document.addEventListener("mouseup",this.mouseUp)}componentWillUnmount(){document.removeEventListener("mouseup",this.mouseUp),this.splitViewContainer.removeEventListener("mousedown",this.mouseDown),this.splitViewContainer.removeEventListener("mousemove",this.mouseMove,{passive:!0})}mouseUp(t){this.state.dragging&&(this.ignoreNextClick=!0),this.setState({dragStart:null,dragging:!1})}onClick(t){this.ignoreNextClick?this.ignoreNextClick=!1:this.props.onClick(t)}mouseDown(t){this.setState({dragStart:{x:t.clientX,y:t.clientY}})}shouldComponentUpdate(t,e){return!0}componentDidUpdate(t,e){this.props.tracking&&!t.tracking&&this.setSplitPosition(this.state.splitPercent)}mouseMove(t){this.state.dragStart?(this.setState({dragging:!0}),this.props.onDrag(t.movementX,t.movementY)):this.trackLocation(t)}trackLocation(t){if(!this.splitViewContainer)return;const e=this.splitViewContainer.getBoundingClientRect(),i=(t.pageX-e.left)/this.splitViewContainer.offsetWidth*100;i<=100&&(this.setState({splitPercent:i}),this.props.tracking&&this.setSplitPosition(i))}setSplitPosition(t){this.splitViewClipper.style.width=t+"%"}focus(){this.splitViewContainer.focus()}render(){return Object(h.jsxs)("div",{className:l()("split-view-container",{dragging:this.state.dragging}),ref:t=>this.setSplitViewContainerRef(t),tabIndex:"-1",onClick:t=>this.onClick(t),children:[Object(h.jsx)("div",{className:l()("split-view-clipper",{"show-border":this.props.splitBorderVisible}),ref:t=>this.setSplitViewClipperRef(t),children:this.props.leftSideContent}),this.props.children]})}}var x=T;function k(t){return t<10?"0"+t:""+t}var L=function(t){const e=Math.floor(t/3600),i=Math.floor(t%3600/60),s=Math.floor(t%60),n=Math.floor((t-Math.floor(t))/.04);return k(e)+":"+k(i)+":"+k(s)+"."+k(n)};var N=t=>{let{position:e}=t;return Object(h.jsx)("div",{className:"time-display",children:L(e)})};function I(t){return t>0?"+":""}var A=t=>{let{offset:e}=t;return 0===e?null:Object(h.jsxs)("div",{className:"offset-indicator",children:["offset: ",I(e),.04*e]})};i(308);const _=(t,e,i)=>({name:t,keys:e,description:i}),F={PLAY:_("PLAY","l","Play video"),PAUSE:_("PAUSE","k","Pause video"),PLAY_PAUSE:_("PLAY_PAUSE","space","Play/Pause video"),STEP_FORWARD_FRAME:_("STEP_FORWARD_FRAME",".","Step forward 1 frame"),STEP_BACKWARD_FRAME:_("STEP_BACKWARD_FRAME",",","Step backward 1 frame"),STEP_FORWARD:_("STEP_FORWARD",["/","-"],"Step forward 1 second"),STEP_BACKWARD:_("STEP_BACKWARD","m","Step backward 1 second"),FULLSCREEN:_("FULLSCREEN","f","Toggle full screen"),SHARE:_("SHARE","c","Copy shareable url to clipboard"),TOGGLE_TRACKING:_("TOGGLE_TRACKING","t","Toggle split position follows mouse"),LEFT_ONLY:_("LEFT_ONLY","]","View only left video"),RIGHT_ONLY:_("RIGHT_ONLY","[","View only right video"),TIMESHIFT_DECREASE:_("OFFSET_DECREASE","<","Decrease timeshift between videos"),TIMESHIFT_INCREASE:_("OFFSET_INCREASE",">","Increase timeshift between videos"),TIMESHIFT_RESET:_("OFFSET_RESET","r","Reset timeshift between videos"),ZOOM_IN:_("ZOOM_IN","u","Zoom in"),ZOOM_OUT:_("ZOOM_OUT","i","Zoom out"),PAN_UP:_("PAN_UP","up","Pan up"),PAN_DOWN:_("PAN_DOWN","down","Pan down"),PAN_RIGHT:_("PAN_RIGHT","right","Pan right"),PAN_LEFT:_("PAN_LEFT","left","Pan left"),REST_PAN_ZOOM:_("RESET_PAN_ZOOM","0","Reset pan and zoom to default"),TOGGLE_HELP:_("TOOGLE_HELP","esc","Toggle help window"),TOGGLE_SPLIT_BORDER_VISIBLE:_("TOGGLE_SPLIT_BORDER_VISIBLE","s","Toggle split border visible")},U=Object.keys(F).reduce(((t,e)=>Object.assign(t,{[F[e].name]:F[e].keys})),{});console.log("KEY_MAP: ".concat(JSON.stringify(U)));const M=t=>{let{visible:e,onClick:i}=t;return Object(h.jsxs)("div",{className:l()("help",{hidden:!e}),children:[Object(h.jsxs)("div",{className:"help-header",children:[Object(h.jsx)("h3",{className:"padding10",children:"Vivict - Vivict Video Comparison Tool"}),Object(h.jsx)("div",{className:"close-button",onClick:()=>i(),children:Object(h.jsx)(c.i,{})})]}),Object(h.jsxs)("div",{children:[Object(h.jsx)("h4",{className:"padding10",children:"Keybindings:"}),H(),B(),z()]})]})},D=t=>{let{onClick:e,className:i}=t;return Object(h.jsx)("div",{className:"help-button "+i,onClick:t=>e(t),children:Object(h.jsx)(c.c,{})})},H=()=>Object.keys(F).map((t=>{const e=F[t];return Object(h.jsxs)("div",{children:[Object(h.jsx)("span",{className:"bold",children:e.keys}),"  "+e.description]},"keybinding-"+e.name)})),B=()=>Object(h.jsx)("h4",{className:"padding10",children:"Copyright 2019 Sveriges Television AB."}),z=()=>Object(h.jsx)("a",{href:"https://github.com/SVT/vivict",children:"Contribute on Github, released under MIT"});function G(t){return S(t)?"hls":w(t)?"dash":"url"}function W(t){return"hls"===t||"dash"===t}const Z=new URLSearchParams(window.location.search),K={hls:"https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8",dash:"https://dash.akamaized.net/dash264/TestCases/2a/qualcomm/1/MultiResMPEG2.mpd",av1:"https://storage.googleapis.com/bitmovin-demos/av1/stream.mpd"}[Z.get("defaultSource")?Z.get("defaultSource"):"hls"],Y=Z.get("leftVideoUrl")||K,q=Z.get("rightVideoUrl")||Y,J=Number(Z.get("leftVideoVariant"))||0,X=Number(Z.get("rightVideoVariant"))||0,Q=Number(Z.get("position"))||0,$=Boolean(Z.get("hideSourceSelector")),tt=Boolean(Z.get("hideHelp")),et={type:G(Y),name:Y,url:Y,variant:J,position:Q},it={type:G(q),name:q,url:q,variant:X,position:Q};class st extends s.Component{constructor(t){super(t),this.shortCutHandlers=[[F.STEP_FORWARD,()=>this.step(25)],[F.STEP_FORWARD_FRAME,()=>this.step(1)],[F.STEP_BACKWARD_FRAME,()=>this.step(-1)],[F.STEP_BACKWARD,()=>this.step(-25)],[F.PLAY_PAUSE,()=>this.playPause()],[F.FULLSCREEN,()=>this.fullscreen()],[F.TOGGLE_TRACKING,()=>this.toggleTracking()],[F.LEFT_ONLY,()=>this.splitView.setSplitPosition(100)],[F.RIGHT_ONLY,()=>this.splitView.setSplitPosition(0)],[F.TIMESHIFT_INCREASE,()=>this.changeOffset(1)],[F.TIMESHIFT_DECREASE,()=>this.changeOffset(-1)],[F.TIMESHIFT_RESET,()=>this.changeOffset(0)],[F.ZOOM_IN,()=>this.zoomIn()],[F.ZOOM_OUT,()=>this.zoomOut()],[F.PAN_UP,()=>this.pan(0,10)],[F.PAN_DOWN,()=>this.pan(0,-10)],[F.PAN_RIGHT,()=>this.pan(-10,0)],[F.PAN_LEFT,()=>this.pan(10,0)],[F.REST_PAN_ZOOM,()=>this.resetPanZoom()],[F.SHARE,()=>this.createShareUrl()],[F.PLAY,()=>this.playForward()],[F.PAUSE,()=>this.pause()],[F.TOGGLE_HELP,()=>this.toggleShowHelp()],[F.TOGGLE_SPLIT_BORDER_VISIBLE,()=>this.toggleSplitBorderVisible()]].reduce(((t,e)=>{let[i,s]=e;return Object.assign(t,{[i.name]:s})}),{}),this.setVideoViewerRef=t=>{this.videoViewer=t},this.setRightVideoRef=t=>{console.log("setRightVideoRef",t),this.rightVideo=t},this.setLeftVideoRef=t=>{this.leftVideo=t},this.setSplitViewRef=t=>{this.splitView=t},this.state={playing:!1,duration:0,position:0,leftSource:{name:"NONE",url:null,variant:J},rightSource:{name:"NONE",url:null,variant:X},tracking:!0,splitBorderVisible:!0,rightVideoOffset:0,showHelp:!tt,showSourceSelector:!$,playReverse:!1,userDefinedPanZoom:!1},console.dir(this.state),this.onFullScreenChange=this.onFullScreenChange.bind(this)}setPosition(t){this.setState({position:t})}setPlaying(t){this.setState({playing:t})}setLeftSource(t){this.setState({leftSource:t})}setRightSource(t){this.setState({rightSource:t})}toggleTracking(){this.setState({tracking:!this.state.tracking})}changeOffset(t){0===t?this.setState({rightVideoOffset:t}):this.setState({rightVideoOffset:this.state.rightVideoOffset+t}),this.state.playing?this.pause().then((()=>this.play())):this.seek(this.leftVideo.currentTime())}playPause(){this.state.playing?this.pause():this.play()}async step(t){const e=this.rightVideo.currentTime()+.04*t;this.rightVideo.quickSeek(e),this.leftVideo.quickSeek(e)}fullscreen(){var t;document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen():(t=this.videoViewer).requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}onTimeUpdate(t){this.setPosition(t)}onDurationSet(t){this.setState({duration:t})}syncPlayers(){this.leftVideo.seek(this.rightVideo.currentTime()),this.setPosition(this.leftVideo.currentTime())}async playForward(){return this.state.playing&&await this.pause(),this.leftVideo.playbackRate=1,this.rightVideo.playbackRate=1,this.play()}async play(){if(this.state.playing)return Promise.resolve();await Promise.all([this.rightVideo.play(),this.leftVideo.play()]),this.setPlaying(!0)}async createShareUrl(){if("file"===this.state.leftSource.type||"file"===this.state.rightSource.type)alert("Shareable URL cannot be created since you are viewing a local file!");else{const t=W(this.state.leftSource.type)?"&leftVideoVariant=".concat(this.state.leftSource.variant):"",e=W(this.state.rightSource.type)?"&rightVideoVariant=".concat(this.state.rightSource.variant):"",i="".concat(window.location.host).concat(window.location.pathname,"?position=").concat(this.state.position)+"&leftVideoUrl=".concat(this.state.leftSource.url).concat(t)+"&rightVideoUrl=".concat(this.state.rightSource.url).concat(e)+(Z.get("hideSourceSelector")?"&hideSourceSelector=".concat(Z.get("hideSourceSelector")):"")+(Z.get("hideHelp")?"&hideHelp=".concat(Z.get("hideHelp")):"");console.log("Copying to clipboard: "+i),function(t){let e=document.createElement("textarea");document.body.appendChild(e),e.value=t,e.select(),document.execCommand("copy"),document.body.removeChild(e)}(i)}}async pause(){return this.state.playing?(this.rightVideo.pause(),this.leftVideo.pause(),this.setPlaying(!1),this.seek(this.leftVideo.currentTime())):Promise.resolve()}async seek(t){return this.setState({position:t}),Promise.all([this.leftVideo.seek(t),this.rightVideo.seek(t+.04*this.state.rightVideoOffset)])}async onLeftVariantChange(t){console.log("left variant changed: ".concat(JSON.stringify(t))),await this.changeVariant(this.leftVideo,t)}async onRightVariantChange(t){console.log("right variant changed: ".concat(JSON.stringify(t))),await this.changeVariant(this.rightVideo,t)}async onLeftSourceChange(t){await this.changeSource(this.leftVideo,t),this.setLeftSource(t),this.splitView.focus()}async onRightSourceChange(t){await this.changeSource(this.rightVideo,t),this.setRightSource(t),this.splitView.focus()}async changeVariant(t,e){this.pauseAndExecute(t,(async()=>{this.setState({leftSource:Object.assign({},this.state.leftSource,{variant:e})}),await t.setVariant(e)}))}async changeSource(t,e){console.log("Change source ".concat(e.url," ").concat(e.variant)),this.pauseAndExecute(t,(async()=>{await t.loadSource(e.url,e.variant)}))}async pauseAndExecute(t,e){const i=this.state.playing,s=this.state.playReverse;await this.pause();const n=t.currentTime();console.log("".concat(JSON.stringify(t.props)," time: ").concat(n)),await e(),await this.seek(n),i&&await this.play(),s&&await this.playReverse()}zoomIn(){this.leftVideo.zoomIn(),this.rightVideo.zoomIn(),this.setState({userDefinedPanZoom:!0})}zoomOut(){this.leftVideo.zoomOut(),this.rightVideo.zoomOut(),this.setState({userDefinedPanZoom:!0})}resetPanZoom(){this.leftVideo.resetPanZoom(),this.rightVideo.resetPanZoom(),this.setState({userDefinedPanZoom:!1})}pan(t,e){this.leftVideo.pan(t,e),this.rightVideo.pan(t,e),this.setState({userDefinedPanZoom:!0})}toggleShowHelp(){this.setState({showHelp:!this.state.showHelp})}toggleSplitBorderVisible(){this.setState({splitBorderVisible:!this.state.splitBorderVisible})}onFullScreenChange(){this.state.userDefinedPanZoom||this.resetPanZoom()}componentDidMount(){this.splitView.focus(),this.seek(Q).catch((t=>console.trace(t))),this.videoViewer.addEventListener("fullscreenchange",this.onFullScreenChange)}componentWillUnmount(){this.videoViewer.removeEventListener("fullscreenchange",this.onFullScreenChange)}render(){return Object(h.jsxs)("div",{className:"video-viewer",tabIndex:"0",ref:this.setVideoViewerRef,children:[Object(h.jsx)(N,{position:this.state.position}),Object(h.jsxs)(o.HotKeys,{className:"hotkeys-div",keyMap:U,handlers:this.shortCutHandlers,children:[Object(h.jsxs)(x,{tracking:this.state.tracking,splitBorderVisible:this.state.splitBorderVisible,onDrag:(t,e)=>this.pan(t,e),onClick:()=>this.playPause(),ref:this.setSplitViewRef,leftSideContent:Object(h.jsx)(O,{muted:!0,ref:this.setLeftVideoRef}),children:[Object(h.jsx)(O,{ref:this.setRightVideoRef,onTimeUpdate:t=>this.onTimeUpdate(t),onDurationSet:t=>this.onDurationSet(t)}),Object(h.jsx)("div",{className:l()("big-play-button",{hidden:this.state.playing||0!==this.state.position}),onClick:()=>this.play(),children:Object(h.jsx)(c.f,{size:"32px"})})]}),Object(h.jsx)(d,{visible:this.state.showSourceSelector,playing:this.state.playing,onPlay:()=>this.playPause(),onStep:t=>this.step(t),onFullscreen:()=>this.fullscreen(),duration:this.state.duration,onSeek:t=>this.seek(t),position:this.state.position}),Object(h.jsx)(C,{visible:this.state.showSourceSelector,className:"left-source-selector",defaultSource:et,onChange:t=>this.onLeftSourceChange(t),onVariantChange:t=>this.onLeftVariantChange(t)}),Object(h.jsx)(C,{visible:this.state.showSourceSelector,className:"right-source-selector",defaultSource:it,onChange:t=>this.onRightSourceChange(t),onVariantChange:t=>this.onRightVariantChange(t)}),Object(h.jsx)(A,{offset:this.state.rightVideoOffset}),Object(h.jsx)(M,{visible:this.state.showHelp,onClick:()=>this.toggleShowHelp()}),Object(h.jsx)(D,{onClick:()=>this.toggleShowHelp()})]})]})}}var nt=st;class at extends s.Component{render(){return Object(h.jsx)("div",{className:"App",children:Object(h.jsx)(nt,{})})}}var ot=at;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(Object(h.jsx)(ot,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((t=>{t.unregister()}))}},[[309,1,2]]]);
//# sourceMappingURL=main.1987c72c.chunk.js.map